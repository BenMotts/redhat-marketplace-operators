apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: zabbixservers.kubernetes.zabbix.com
spec:
  group: kubernetes.zabbix.com
  names:
    kind: ZabbixServer
    listKind: ZabbixServerList
    plural: zabbixservers
    singular: zabbixserver
    shortNames:
      - zs
  scope: Namespaced
  subresources:
    status: {}
  version: v1alpha1
  versions:
    - name: v1alpha1
      served: true
      storage: true
  preserveUnknownFields: true
  validation:
    openAPIV3Schema:
      properties:
        spec:
          x-kubernetes-preserve-unknown-fields: true
          description: Configuration parameters for Zabbix server installation
          properties:
            java_gateway_size:
              description: The desired number of Zabbix Java Gateways for the deployment
              minimum: 0
              type: integer
            db_server_host:
              description: MySQL database host name
              minLength: 1
              type: string
            db_server_port:
              description: MySQL database port number
              type: integer
            client_db_tlssecret:
              description: >-
                Secret volume with root_ca.pem, client-cert.pem and
                client-key.pem files to enable TLS encryption between Zabbix
                server / web and MySQL database
              type: string
            history_storage_url:
              description: 'History storage HTTP[S] URL'
              type: string
            mysql_database:
              description: Database name for Zabbix installation
              minLength: 1
              type: string
            zabbix_mysqlsecret:
              description: MySQL database credentials secret name
              minLength: 1
              type: string
            java_gateway:
              description: Configuration parameters for Zabbix Java Gateway
              title: Zabbix Java Gateway configuration
              properties:
                ext_libs_claim:
                  description: Additional Java libraries for Zabbix Java Gateway
                  type: string
                debug_level:
                  description: Specifies debug level
                  enum:
                    - all
                    - debug
                    - info
                    - warn
                    - error
                    - fatal
                    - 'off'
                    - trace
                  type: string
                start_pollers:
                  description: Number of Zabbix Java Gateway threads
                  maximum: 1000
                  minimum: 1
                  type: integer
                timeout:
                  description: Timeout for JMX network operations
                  maximum: 30
                  minimum: 1
                  type: integer
                java_options:
                  description: Additional arguments for JVM
                  type: string
              type: object
            server:
              description: Configuration parameters for Zabbix server
              title: Zabbix server configuration
              properties:
                tls_enc_secret:
                  title: TLS encryption secret
                  description: >-
                    TLS certificates or / and PSK key files to enable encryption
                    between Zabbix agent and Zabbix proxy
                  type: string
                modules_claim:
                  title: Modules volume
                  description: Zabbix agent loadable modules volume claim
                  type: string
                alert_scripts_claim:
                  title: Alert scripts volume
                  description: Location of custom alert scripts
                  type: string
                external_scripts_claim:
                  title: External scripts volume
                  description: Location of external scripts
                  type: string
                ssl_certs_secret:
                  title: SSL client certificates secret
                  description: >-
                    Location of SSL client certificate files for client
                    authentication
                  type: string
                ssl_keys_secret:
                  title: SSL private key files secret
                  description: Location of SSL private key files for client authentication
                  type: string
                ssl_ca_secret:
                  title: SSL CA secret
                  description: >-
                    Override the location of certificate authority (CA) files
                    for SSL server certificate verification. If not set,
                    system-wide directory will be used
                  type: string
                ssh_keys_secret:
                  title: SSH keys secret
                  description: >-
                    Location of public and private keys for SSH checks and
                    actions
                  type: string
                mibs_claim:
                  title: MIB files volume
                  description: Additional MIB files location
                  type: string
                real_time_export_claim:
                  title: Real-time export claim
                  description: >-
                    Directory for real-time export of events, history and trends
                    in newline-delimited JSON format
                  type: string
                cache_size:
                  description: 'Size of configuration cache, in bytes'
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                cache_update_frequency:
                  description: >-
                    How often Zabbix will perform update of configuration cache,
                    in seconds
                  maximum: 3600
                  minimum: 1
                  type: integer
                db_tls_cipher:
                  description: >-
                    The list of encryption ciphers that Zabbix server permits
                    for TLS protocols up through TLSv1.2
                  type: string
                db_tls_cipher_13:
                  description: >-
                    The list of encryption ciphersuites that Zabbix server
                    permits for TLSv1.3 protocol
                  type: string
                db_tls_connect:
                  description: >-
                    Setting this option enforces to use TLS connection to
                    database
                  enum:
                    - ''
                    - required
                    - verify_ca
                    - verify_full
                  type: string
                debug_level:
                  description: Specifies debug level for Zabbix server
                  maximum: 5
                  minimum: 0
                  type: integer
                history_cache_size:
                  description: 'Size of history cache, in bytes'
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                history_index_cache_size:
                  description: 'Size of history index cache, in bytes'
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                history_storage_types:
                  description: >-
                    Comma separated list of value types to be sent to the
                    history storage
                  type: string
                history_storage_date_index:
                  description: >-
                    Enable preprocessing of history values in history storage to
                    store values in different indices based on date
                  type: boolean
                housekeeping_frequency:
                  description: >-
                    How often Zabbix will perform housekeeping procedure (in
                    hours)
                  maximum: 24
                  minimum: 0
                  type: integer
                log_slow_queries:
                  description: >-
                    How long a database query may take before being logged (in
                    milliseconds)
                  maximum: 3600000
                  minimum: 0
                  type: integer
                max_housekeeper_delete:
                  description: >-
                    No more than specified amount of rows (corresponding to
                    [tablename], [field], [value]) will be deleted per one task
                    in one housekeeping cycle
                  maximum: 1000000
                  minimum: 0
                  type: integer
                proxy_config_frequency:
                  description: >-
                    How often Zabbix server sends configuration data to a Zabbix
                    proxy in seconds.
                  maximum: 604800
                  minimum: 1
                  type: integer
                proxy_data_frequency:
                  description: >-
                    How often Zabbix server requests history data from a Zabbix
                    proxy in seconds. Used only for proxies in a passive mode
                  maximum: 3600
                  minimum: 1
                  type: integer
                start_alerters:
                  description: Number of pre-forked instances of alerters
                  maximum: 100
                  minimum: 1
                  type: integer
                start_db_syncers:
                  description: Number of pre-forked instances of DB Syncers
                  maximum: 100
                  minimum: 4
                  type: integer
                start_discoverers:
                  description: Number of pre-forked instances of discoverers
                  maximum: 250
                  minimum: 0
                  type: integer
                start_escalators:
                  description: Number of pre-forked instances of escalators
                  maximum: 100
                  minimum: 1
                  type: integer
                start_http_pollers:
                  description: Number of pre-forked instances of HTTP pollers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_ipmi_pollers:
                  description: Number of pre-forked instances of IPMI pollers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_java_pollers:
                  description: Number of pre-forked instances of Java pollers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_lld_processors:
                  description: >-
                    Number of pre-forked instances of low-level discovery (LLD)
                    workers
                  maximum: 100
                  minimum: 1
                  type: integer
                start_pingers:
                  description: Number of pre-forked instances of ICMP pingers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_pollers:
                  description: Number of pre-forked instances of pollers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_pollers_unreachable:
                  description: >-
                    Number of pre-forked instances of pollers for unreachable
                    hosts (including IPMI and Java)
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_preprocessors:
                  description: Number of pre-forked instances of preprocessing workers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_proxy_pollers:
                  description: >-
                    Number of pre-forked instances of pollers for passive
                    proxies
                  maximum: 250
                  minimum: 0
                  type: integer
                start_timers:
                  description: Number of pre-forked instances of timers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_trappers:
                  description: Number of pre-forked instances of trappers
                  maximum: 1000
                  minimum: 0
                  type: integer
                start_vmware_collectors:
                  description: Number of pre-forked vmware collector instances
                  maximum: 250
                  minimum: 0
                  type: integer
                stats_allowed_ip:
                  description: >-
                    List of comma delimited IP addresses, optionally in CIDR
                    notation, or DNS names of external Zabbix instances
                  type: string
                timeout:
                  description: >-
                    Specifies how long we wait for agent, SNMP device or
                    external check (in seconds)
                  maximum: 30
                  minimum: 1
                  type: integer
                tls_cipher_all:
                  description: >-
                    GnuTLS priority string or OpenSSL (TLS 1.2) cipher string.
                    Override the default ciphersuite selection criteria for
                    certificate- and PSK-based encryption
                  type: string
                tls_cipherall_13:
                  description: >-
                    Cipher string for OpenSSL 1.1.1 or newer in TLS 1.3.
                    Override the default ciphersuite selection criteria for
                    certificate- and PSK-based encryption
                  type: string
                tlsciphercert:
                  description: >-
                    GnuTLS priority string or OpenSSL (TLS 1.2) cipher string.
                    Override the default ciphersuite selection criteria for
                    certificate-based encryption
                  type: string
                tls_cipher_cert_13:
                  description: >-
                    Cipher string for OpenSSL 1.1.1 or newer in TLS 1.3.
                    Override the default ciphersuite selection criteria for
                    certificate-based encryption
                  type: string
                tls_cipher_psk:
                  description: >-
                    GnuTLS priority string or OpenSSL (TLS 1.2) cipher string.
                    Override the default ciphersuite selection criteria for
                    PSK-based encryption
                  type: string
                tls_cipher_psk_13:
                  description: >-
                    Cipher string for OpenSSL 1.1.1 or newer in TLS 1.3.
                    Override the default ciphersuite selection criteria for
                    PSK-based encryption
                  type: string
                trapper_timeout:
                  description: >-
                    Specifies how many seconds trapper may spend processing new
                    data
                  maximum: 300
                  minimum: 1
                  type: integer
                trend_cache_size:
                  description: 'Size of trend cache, in bytes'
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                unavailable_delay:
                  description: >-
                    How often host is checked for availability during the
                    unavailability period, in seconds
                  maximum: 3600
                  minimum: 1
                  type: integer
                unreachable_delay:
                  description: >-
                    How often host is checked for availability during the
                    unreachability period, in seconds
                  maximum: 3600
                  minimum: 1
                  type: integer
                unreachable_period:
                  description: >-
                    After how many seconds of unreachability treat a host as
                    unavailable
                  maximum: 3600
                  minimum: 1
                  type: integer
                value_cache_size:
                  description: 'Size of history value cache, in bytes'
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                vmware_cache_size:
                  description: Shared memory size for storing VMware data
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                vmware_frequency:
                  description: >-
                    Delay in seconds between data gathering from a single VMware
                    service
                  maximum: 86400
                  minimum: 10
                  type: integer
                vmware_perf_frequency:
                  description: >-
                    Delay in seconds between performance counter statistics
                    retrieval from a single VMware service
                  maximum: 86400
                  minimum: 10
                  type: integer
                vmware_timeout:
                  description: >-
                    The maximum number of seconds vmware collector will wait for
                    a response from VMware service (vCenter or ESX hypervisor)
                  maximum: 300
                  minimum: 1
                  type: integer
                export_file_size:
                  description: Maximum size per export file in bytes
                  type: string
                  pattern: '^(|\d+|\d+[KMGT])$'
                load_module:
                  description: >-
                    Module to load at server startup. Modules are used to extend
                    functionality of the server
                  type: string
                tls_ca_file_name:
                  description: >-
                    File containing the top-level CA(s) certificates for peer
                    certificate verification, used for encrypted communications
                    between Zabbix components
                  type: string
                tls_crl_file_name:
                  description: >-
                    File containing revoked certificates. This parameter is used
                    for encrypted communications between Zabbix components
                  type: string
                tls_cert_file_name:
                  description: >-
                    File containing the server certificate or certificate chain,
                    used for encrypted communications between Zabbix components
                  type: string
                tls_key_file_name:
                  description: >-
                    File containing the server private key, used for encrypted
                    communications between Zabbix components
                  type: string
              type: object
            web:
              description: Configuration parameters for Zabbix web-interface
              title: Zabbix web-interface configuration
              properties:
                deny_gui_access:
                  description: Enable maintenance mode
                  type: boolean
                gui_access_ip_range:
                  description: >-
                    Array of IP addresses, which are allowed to connect to
                    frontend (optional)
                  type: string
                gui_warning_msg:
                  description: >-
                    A message you can enter to inform users about the
                    maintenance
                  type: string
                sso_certs_secrets:
                  description: >-
                    Secret volume with sp.key, sp.crt and idp.crt files as
                    custom certificates SAML authentification
                  type: string
                sso_settings:
                  description: Additional SAML parameters
                  type: string
                db_cipher_list:
                  description: >-
                    Custom list of valid ciphers for connection to MySQL
                    database
                  type: string
                db_double_ieee754:
                  description: Enables extended range of numeric (float) values
                  type: boolean
                db_encryption:
                  description: Enforces to use TLS connection to database
                  type: boolean
                db_verify_host:
                  description: Enables host verification
                  type: boolean
                enable_web_access_log:
                  description: Enables Web server access log
                  type: boolean
                history_storage_types:
                  description: Array of value types to be sent to the history storage
                  type: string
                max_execution_time:
                  description: The varable is PHP max_execution_time option
                  type: integer
                max_input_time:
                  description: The varable is PHP max_input_time option
                  type: integer
                memory_limit:
                  description: The varable is PHP memory_limit option
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                post_max_size:
                  description: The varable is PHP post_max_size option
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                server_name:
                  description: >-
                    Visible Zabbix installation name in right top corner of the
                    web interface
                  type: string
                session_name:
                  description: >-
                    String used as the name of the Zabbix frontend session
                    cookie
                  type: string
                timezone:
                  description: Zabbix web-interface timezone in PHP format
                  pattern: ^\S+$
                  type: string
                upload_max_filesize:
                  description: The varable is PHP upload_max_filesize option
                  pattern: '^(\d+|\d+[KMGT])$'
                  type: string
                zabbix_web_sslsecret:
                  description: >-
                    SSL certificates for Zabbix web-interface. The secret volume
                    must contain ssl.crt, ssl.key and dhparam.pem files
                  type: string
              required:
                - server_name
                - timezone
              type: object
            web_enable_route:
              description: Assign Zabbix URL for Web interface
              type: boolean
            web_size:
              description: The desired number of Zabbix web-interfaces for the deployment
              minimum: 1
              type: integer
            zabbix_url:
              description: Zabbix Web URL (if not filled will be generated automatically)
              type: string
          required:
            - web_size
            - java_gateway_size
            - db_server_host
            - mysql_database
            - zabbix_mysqlsecret
          type: object
        status:
          description: Deployment status information
          properties:
            conditions:
              type: object
            java_gateway_status:
              description: Status of Java Gateway deployment operation
              type: string
            phase:
              description: Status of deployment operation
              enum:
                - Running
                - Pending
                - Failed
              type: string
            reason:
              description: Error description during deployment
              type: string
            server_status:
              description: Status of Zabbix server deployment operation
              type: string
            web_status:
              description: Status of Web server deployment operation
              type: string
          type: object
      type: object
